<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Absensi Siswa</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; display:flex; flex-direction:column; height:100vh; }
header { background:#007bff; color:white; padding:15px; text-align:center; }
#content { flex:1; padding:20px; overflow:auto; }
#absensi-wrapper { background:white; border-radius:10px; overflow-y:auto; border:2px solid #007bff; margin-bottom:20px; }
#absensi-table { width:100%; border-collapse:collapse; }
#absensi-table th, #absensi-table td { border:1px solid #ccc; padding:8px; text-align:center; }
.highlight { background-color:#ffff99 !important; }
#tvKosong { display:none; text-align:center; font-weight:bold; color:red; margin-top:20px; }
</style>
</head>
<body>

<header>
    <h1>ABSENSI SISWA</h1>
    <h3>SMPN 20 Konawe Selatan</h3>
</header>

<div id="content">
    <div id="absensi-wrapper">
        <table id="absensi-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>NIS</th>
                    <th>Nama</th>
                    <th>Kelas</th>
                    <th>Jam Datang</th>
                    <th>Jam Pulang</th>
                    <th>Status</th>
                    <th>Keterangan</th>
                </tr>
            </thead>
            <tbody id="absensi-body"></tbody>
        </table>
    </div>
    <p id="tvKosong">Kosong</p>
</div>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCAg9Kb4I3dp-fcCIp5RzQKY8mJ3sD4hPU",
  authDomain: "absensi-smpn-20-konsel.firebaseapp.com",
  projectId: "absensi-smpn-20-konsel",
  storageBucket: "absensi-smpn-20-konsel.appspot.com",
  messagingSenderId: "247838919432",
  appId: "1:247838919432:web:4505c7d499fb5d716dfabd",
  measurementId: "G-1TNJRBYFEV"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const absensiBody = document.getElementById("absensi-body");
const tvKosong = document.getElementById("tvKosong");

let allSiswa = [];

// Hari ini
function getToday() {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
}

// Update tabel
function updateTable(data){
    absensiBody.innerHTML="";
    if(data.length === 0){
        tvKosong.style.display = "block";
        document.getElementById("absensi-wrapper").style.display = "none";
        return;
    } else {
        tvKosong.style.display = "none";
        document.getElementById("absensi-wrapper").style.display = "block";
    }

    data.forEach((s,index)=>{
        const jamDatang = s.jamDatang ? new Date(s.jamDatang.seconds*1000).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}) : '';
        const jamPulang = s.jamPulang ? new Date(s.jamPulang.seconds*1000).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}) : '';
        const row = document.createElement("tr");
        row.innerHTML = `<td>${index+1}</td><td>${s.nis}</td><td>${s.nama}</td><td>${s.kelas}</td><td>${jamDatang}</td><td>${jamPulang}</td><td>${s.status}</td><td>${s.keterangan||''}</td>`;
        absensiBody.appendChild(row);
    });
}

// Realtime absensi hari ini
db.collection("absensi").doc(getToday()).onSnapshot(doc=>{
    const data = doc.data() || {};
    allSiswa = Object.values(data).map(s=>{
        s.nis = String(s.nis);
        return s;
    });
    updateTable(allSiswa);
});
</script>
</body>
</html>
