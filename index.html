<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Absensi Siswa</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
header { background:#007bff; display:flex; align-items:center; justify-content:center; padding:15px 20px; color:white; gap:15px; flex-direction:column; text-align:center; }
header img { width:80px; height:80px; object-fit:contain; }
header h1 { margin:5px 0 0 0; font-size:26px; }
header h3 { margin:0; font-size:16px; font-weight:normal; }
#container { display:flex; gap:20px; padding:20px; flex-wrap:wrap; justify-content:center; align-items:flex-start; }
#absensi-wrapper { flex:1 1 700px; background:white; border-radius:10px; overflow-y:auto; max-height:480px; border:2px solid #007bff; }
#absensi-table { width:100%; border-collapse:collapse; }
#absensi-table th, #absensi-table td { border:1px solid #ccc; padding:8px; }
#absensi-table th { background-color:#007bff; color:white; position:sticky; top:0; z-index:1; text-align:center; }
#absensi-table td { text-align:left; }
#absensi-table td:nth-child(1), #absensi-table td:nth-child(3),
#absensi-table td:nth-child(4), #absensi-table td:nth-child(5),
#absensi-table td:nth-child(6), #absensi-table td:nth-child(7) { text-align:center; }
#absensi-table td:nth-child(2) { text-align:left; font-weight:bold; }
/* Responsif */
@media(max-width:1000px){
    #container { flex-direction:column; align-items:center; }
    #absensi-wrapper { width:90%; max-width:800px; }
}
</style>
</head>
<body>

<header>
    <img src="logo.png" alt="Logo SMPN 20">
    <h1>ABSENSI SISWA</h1>
    <h3>SMPN 20 Konawe Selatan</h3>
</header>

<div id="container">
    <div id="absensi-wrapper">
        <table id="absensi-table">
            <thead>
                <tr>
                    <th>NIS</th>
                    <th>Nama</th>
                    <th>Kelas</th>
                    <th>Jam Datang</th>
                    <th>Jam Pulang</th>
                    <th>Status</th>
                    <th>Keterangan</th>
                </tr>
            </thead>
            <tbody id="absensi-body"></tbody>
        </table>
    </div>
</div>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCAg9Kb4I3dp-fcCIp5RzQKY8mJ3sD4hPU",
  authDomain: "absensi-smpn-20-konsel.firebaseapp.com",
  projectId: "absensi-smpn-20-konsel",
  storageBucket: "absensi-smpn-20-konsel.appspot.com",
  messagingSenderId: "247838919432",
  appId: "1:247838919432:web:4505c7d499fb5d716dfabd",
  measurementId: "G-1TNJRBYFEV"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const absensiBody = document.getElementById("absensi-body");

function getToday(){
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth()+1).padStart(2,'0');
    const dd = String(now.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
}

// Update tabel realtime (siswa absen terakhir di atas)
function updateAbsensiTableRealtime(today){
    db.collection("absensi").doc(today).onSnapshot(doc=>{
        const data = doc.data() || {};
        const siswaArr = Object.values(data).sort((a,b)=>{
            const tA = a.jamPulang ? a.jamPulang.seconds : (a.jamDatang ? a.jamDatang.seconds : 0);
            const tB = b.jamPulang ? b.jamPulang.seconds : (b.jamDatang ? b.jamDatang.seconds : 0);
            return tB - tA; // descending, absen terakhir di atas
        });

        absensiBody.innerHTML="";
        siswaArr.forEach(siswa=>{
            const jamDatang = siswa.jamDatang ? new Date(siswa.jamDatang.seconds*1000).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}) : '';
            const jamPulang = siswa.jamPulang ? new Date(siswa.jamPulang.seconds*1000).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}) : '';
            const row = document.createElement("tr");
            row.innerHTML = `<td>${siswa.nis}</td><td>${siswa.nama}</td><td>${siswa.kelas}</td><td>${jamDatang}</td><td>${jamPulang}</td><td>${siswa.status}</td><td>${siswa.keterangan}</td>`;
            absensiBody.appendChild(row);
        });
    });
}

// Inisialisasi
updateAbsensiTableRealtime(getToday());
</script>
</body>
</html>
